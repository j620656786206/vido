# Vido 專案開發藍圖

**最後更新**: 2026-01-09
**專案願景**: 一個具備韌性、專注於繁體中文的媒體管理平台

---

## 📊 目前狀態

### ✅ 已完成功能（已合併至主分支）

| 功能                          | 狀態    | 說明                                      |
| ----------------------------- | ------- | ----------------------------------------- |
| **Nx Monorepo 架構**          | ✅ 完成 | 使用 Nx 22.x 的 Monorepo 架構             |
| **Go 後端基礎**               | ✅ 完成 | Gin 框架、結構化日誌、錯誤處理            |
| **React 前端腳手架**          | ✅ 完成 | React 19、TanStack Router、TanStack Query |
| **SQLite 資料庫（WAL 模式）** | ✅ 完成 | 資料庫層、遷移系統、Repository 模式       |

**架構健康度**: 🟢 堅實的基礎已建立

---

## 🚧 開發中（活躍的 Worktrees）

### 第一階段：核心媒體管理

#### 005: TMDb 元數據提供者（zh-TW 支援）

**狀態**: 🟡 進行中
**優先級**: P0（關鍵）
**依賴**: 資料庫層

**說明**: 主要元數據來源，支援繁體中文

**功能**:

- 具有速率限制的 TMDb API 客戶端
- 抓取 zh-TW 標題和描述
- 海報/背景圖片檢索
- 電影和影集搜尋

**驗收標準**:

- [x] API 客戶端已實作
- [ ] 速率限制已配置
- [ ] zh-TW 語言支援已驗證
- [ ] 錯誤處理已測試

---

#### 006: 媒體搜尋介面

**狀態**: 🟡 進行中
**優先級**: P0（關鍵）
**依賴**: TMDb 提供者

**說明**: 使用者介面的搜尋功能，顯示 zh-TW 結果

**功能**:

- 防抖動搜尋輸入
- 網格/列表檢視顯示海報
- 醒目顯示繁體中文標題
- 載入和空狀態處理

**驗收標準**:

- [ ] 搜尋功能運作正常
- [ ] 結果正確顯示
- [ ] zh-TW 標題醒目
- [ ] 響應式設計

---

#### 007: 基礎檔案名稱解析器

**狀態**: 🟢 接近完成（測試階段）
**優先級**: P0（關鍵）
**依賴**: 無

**說明**: 基於正規表達式的標準媒體檔名解析器

**功能**:

- 提取標題、年份、畫質、解析度
- 支援影集模式（S01E02）
- 電影模式解析
- 結構化 ParseResult 輸出

**最近提交**:

```
878734a - 構建和 lint 驗證
f31a474 - 匯出所有解析器函式
065f788 - 主要 parseFileName 測試
621da92 - 影集解析器測試
724ec14 - 電影解析器測試
```

**驗收標準**:

- [x] 電影模式已解析
- [x] 影集模式已解析
- [x] 測試已撰寫
- [x] 構建通過
- [ ] 與後端整合

---

### 第二階段：進階智慧功能

#### 008: AI 驅動的檔案名稱解析

**狀態**: 🔴 尚未開始
**優先級**: P1（高）
**依賴**: 基礎檔案解析器

**說明**: 使用 Gemini/Claude API 處理複雜的字幕組命名規則

**核心差異化優勢**: 解決競爭對手的痛點 - 字幕組命名規則是 Radarr/Sonarr/FileBot 無法處理的

**功能**:

- 雙 AI 供應商支援（Gemini + Claude）
- 字幕組模式處理：`[Coalgirls] Show - 01 [BD 1080p]`
- 日文標題提取
- 絕對集數編號
- 回應快取以優化成本

**目標成功率**: 非標準命名 >95%

---

#### 009: 多來源元數據回退

**狀態**: 🟡 進行中（服務層已完成）
**優先級**: P1（高）
**依賴**: TMDb 提供者

**說明**: 跨多個元數據來源的自動容錯轉移

**架構**:

```
TMDb（主要）→ 豆瓣（中文專用）→ AI（最後手段）
```

**功能**:

- MetadataProvider 介面
- 斷路器模式
- 豆瓣爬蟲（中文內容）
- AI 生成元數據作為最後手段
- 多來源結果合併

**最近提交**:

```
9c255a8 - AI 提供者正規表達式修復
1e86987 - 測試套件執行
04c2e24 - 配置更新
6b761cd - 整合測試
b80f61c - 路由端點註冊
```

**驗收標準**:

- [x] MetadataProvider 介面已定義
- [x] TMDb 適配器已創建
- [x] 豆瓣爬蟲已實作
- [x] AI 提供者已整合
- [x] 斷路器已配置
- [x] 服務層已完成
- [ ] API 端點已暴露
- [ ] 前端整合

---

### 第三階段：下載與字幕管理

#### 010: qBittorrent 下載整合

**狀態**: 🟡 進行中（後端已完成）
**優先級**: P2（中）
**依賴**: 無

**說明**: 從 Vido 儀表板監控 qBittorrent 下載

**統一體驗**: 使用者無需切換應用即可看到媒體管線

**功能**:

- qBittorrent API 客戶端
- 列出種子的進度/速度/預估時間
- 按狀態篩選（下載中/做種中/已完成）
- 即時輪詢更新
- 連線錯誤處理

**最近提交**:

```
84f7f0c - 所有測試通過
2cc7beb - 環境變數文件
51febda - OpenAPI 文件
0c9a47c - 錯誤處理
2c88c59 - React Query hooks 測試
23e1a49 - 元件測試
```

**驗收標準**:

- [x] API 客戶端已實作
- [x] 後端處理器已完成
- [x] 測試已撰寫
- [x] OpenAPI 文件已新增
- [ ] 前端元件
- [ ] 即時更新

---

#### 011: 字幕來源整合

**狀態**: 🔴 尚未開始
**優先級**: P2（中）
**依賴**: 基礎檔案解析器

**說明**: 自動字幕搜尋和下載

**市場機會**: 競爭對手如 Bazarr 的中文字幕提供者已損壞

**功能**:

- OpenSubtitles API 整合
- 字幕庫爬蟲（中文字幕）
- 檔案雜湊 + 標題/年份搜尋
- zh-TW/cht 語言代碼支援
- 自動保存在媒體檔案旁

**目標**: 成為最佳中文字幕解決方案

---

## 🎯 即將到來的階段

### 第四階段：使用者體驗（2026 Q2）

#### 媒體庫管理介面

**優先級**: P0
**預估工作量**: 2-3 週

**功能**:

- 瀏覽電影/影集收藏
- 網格/列表/詳細檢視
- 排序和篩選
- 批次操作
- 收藏組織

---

#### 媒體詳情頁面

**優先級**: P0
**預估工作量**: 2 週

**功能**:

- 完整元數據顯示
- 演員和工作人員資訊
- 預告片和相關媒體
- 字幕管理
- 手動編輯元數據

---

#### 下載佇列管理

**優先級**: P1
**預估工作量**: 1 週

**功能**:

- 暫停/繼續/刪除種子
- 優先級調整
- 速度限制
- 分類管理

---

### 第五階段：自動化與智慧（2026 Q3）

#### 自動媒體組織

**優先級**: P1
**預估工作量**: 2 週

**功能**:

- 監視新下載的資料夾
- 自動解析檔案名稱
- 自動抓取元數據
- 移動/重新命名檔案到媒體庫結構
- 重複檢測

---

#### 智慧推薦

**優先級**: P2
**預估工作量**: 2-3 週

**功能**:

- 推薦引擎
- 「你可能喜歡」建議
- 基於類型的發現
- 演員/導演作品集
- 熱門內容（TMDb）

---

#### 字幕品質評分

**優先級**: P2
**預估工作量**: 1 週

**功能**:

- 評價字幕來源
- 使用者評論和評分
- 自動選擇最佳字幕
- 同步檢測
- 格式偏好（SRT、ASS、SSA）

---

### 第六階段：平台功能（2026 Q4）

#### 多使用者支援

**優先級**: P1
**預估工作量**: 3 週

**功能**:

- 使用者驗證
- 權限管理
- 每個使用者的觀看歷史
- 個人播放清單
- 共享媒體庫

---

#### 行動應用程式

**優先級**: P2
**預估工作量**: 6-8 週

**功能**:

- React Native 或 Flutter
- 瀏覽媒體庫
- 遠端控制下載
- 推播通知
- 離線元數據檢視

---

#### Plex/Jellyfin 整合

**優先級**: P2
**預估工作量**: 2 週

**功能**:

- 匯出元數據至 Plex/Jellyfin
- 同步觀看狀態
- 自動媒體庫重新整理
- NFO 檔案生成
- 海報/插圖匯出

---

## 🔧 技術債務與改進

### 高優先級

#### 後端測試

**目前覆蓋率**: 未知
**目標**: >80%

**行動項目**:

- 所有 repository 的單元測試
- API 端點的整合測試
- Mock TMDb/豆瓣客戶端
- 測試資料庫遷移

---

#### 前端測試

**目前覆蓋率**: 最低限度
**目標**: >70%

**行動項目**:

- 使用 Vitest 的元件測試
- TanStack Query hook 測試
- 使用 Playwright 的 E2E 測試
- 無障礙性測試

---

#### 錯誤處理與日誌

**狀態**: 已有基本實作

**改進項目**:

- 集中式錯誤追蹤（Sentry？）
- 使用者友善的錯誤訊息
- 重試策略
- 效能監控

---

#### API 文件

**狀態**: OpenAPI/Swagger 部分實作

**改進項目**:

- 完成所有端點文件
- 新增請求/回應範例
- 驗證文件
- API 版本控制策略

---

### 中優先級

#### 效能優化

- 資料庫查詢優化
- 圖片快取和 CDN
- 大列表的懶載入
- 虛擬捲動
- Bundle 大小優化

---

#### 開發者體驗

- Docker Compose 用於本地開發
- 自動化資料庫種子資料
- 環境變數驗證
- Go 的熱重載（Air 已配置）
- 元件的 Storybook

---

#### CI/CD 管道

- GitHub Actions 工作流程
- 自動化測試
- Linting 和格式檢查
- 構建驗證
- 部署自動化

---

## 📅 里程碑與時程

### 2026 Q1（本季）

**里程碑**: MVP 發布
**目標日期**: 2026 年 3 月底

**關鍵路徑**:

1. ✅ 完成檔案解析器（007）- 第 1 週
2. 🚧 完成 TMDb 提供者（005）- 第 2 週
3. 🚧 完成媒體搜尋介面（006）- 第 3 週
4. 🚧 整合測試 - 第 4 週
5. 部署 MVP - 第 5 週

**MVP 功能**:

- 搜尋電影/影集
- 檢視繁體中文元數據
- 基本檔案名稱解析
- SQLite 資料庫儲存

---

### 2026 Q2

**里程碑**: 核心平台
**目標日期**: 2026 年 6 月底

**交付項目**:

- 多來源元數據回退（009）
- AI 驅動的檔案解析（008）
- 媒體庫管理介面
- 媒體詳情頁面
- qBittorrent 整合（010）

**成功指標**:

- 正確解析 95%+ 的使用者檔案
- 元數據來源故障時零停機時間
- 100+ 活躍使用者測試

---

### 2026 Q3

**里程碑**: 功能完整
**目標日期**: 2026 年 9 月底

**交付項目**:

- 字幕整合（011）
- 自動媒體組織
- 下載佇列管理
- 智慧推薦
- 效能優化

**成功指標**:

- 1000+ 活躍使用者
- 平均 API 回應時間 <500ms
- 使用者滿意度 >4.5/5

---

### 2026 Q4

**里程碑**: 平台擴展
**目標日期**: 2026 年 12 月底

**交付項目**:

- 多使用者支援
- 行動應用程式（iOS/Android）
- Plex/Jellyfin 整合
- 公開 API beta
- 進階功能

---

## 🎖️ 成功指標

### 技術 KPI

- **正常運行時間**: >99.5%
- **API 回應時間**: <500ms（p95）
- **檔案解析成功率**: >95%
- **測試覆蓋率**: 後端 >80%，前端 >70%
- **構建時間**: <2 分鐘

### 產品 KPI

- **活躍使用者**: 2026 Q3 前 1000+
- **使用者留存率**: >60%（30 天）
- **管理的媒體項目**: 100,000+
- **字幕成功率**: >90%
- **使用者滿意度**: >4.5/5

---

## 🚀 競爭優勢

| 功能             | Vido                 | Jellyfin       | Plex           | Radarr/Sonarr     |
| ---------------- | -------------------- | -------------- | -------------- | ----------------- |
| **zh-TW 元數據** | ✅ 原生支援          | ⚠️ 有限        | ⚠️ 有限        | ❌ 無             |
| **字幕組解析**   | ✅ AI 驅動           | ❌ 失敗        | ❌ 失敗        | ❌ 失敗           |
| **多來源回退**   | ✅ TMDb/豆瓣/AI      | ❌ 單一來源    | ❌ 單一來源    | ⚠️ 手動           |
| **中文字幕**     | ✅ 字幕庫 + OpenSubs | ⚠️ 僅 OpenSubs | ⚠️ 僅 OpenSubs | ⚠️ Bazarr（損壞） |
| **下載整合**     | ✅ qBittorrent       | ❌ 無          | ❌ 無          | ⚠️ 內建           |
| **開源**         | ✅ 是                | ✅ 是          | ❌ 否          | ✅ 是             |

---

## 📝 備註

### 設計哲學

1. **韌性優先**: 永不完全失敗；永遠提供回退方案
2. **在地化**: 繁體中文是第一優先，而非事後補充
3. **自動化**: 透過智慧解析和自動化最小化手動工作
4. **簡單性**: 乾淨的介面、合理的預設值、「開箱即用」

### 技術決策

- **Go 後端**: 效能、簡單性、單一二進位檔部署
- **React 前端**: 成熟的生態系統、優秀的開發者體驗
- **SQLite**: 零配置、可靠、適合桌面/NAS 部署
- **Nx Monorepo**: 共享程式碼、一致的工具鏈、可擴展性

### 待解決問題

1. 是否應該支援每位使用者多個媒體庫？
2. 本地部署 vs 雲端部署策略？
3. 進階功能：什麼應該是付費的？
4. 社群擴充的外掛系統？

---

## 🤝 貢獻

這份藍圖是一份活文件。優先級可能會根據以下因素調整：

- 使用者回饋
- 技術發現
- 市場變化
- 資源可用性

**歡迎回饋**: 在 GitHub 上開啟 issue 或討論！

---

**維護者**: Vido 開發團隊
**專案位置**: https://github.com/YOUR_USERNAME/vido
**授權**: MIT（前端/共享）/ Apache 2.0（後端）
